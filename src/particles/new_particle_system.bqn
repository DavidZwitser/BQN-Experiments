âŸ¨câ‡color, winâ‡window, dâ‡draw, key, raymath, rayffiâ‡raylib, mouseâŸ©â†râ†â€¢Import "../../rayed-bqn/rayed.bqn"

wâ€¿h â† 1200â€¿1200
Norm â† Ã·âŸœ(0âŠ¸=âŠ¸++Â´âŒ¾(Ã—Ëœ)) # Credits to Brian E

Take â† {vğ•Šm: (Size m)â†‘â‰1 (Pos m)â†“â‰1 v}
FromTo â† {vğ•Šmfâ€¿mt: mtâŠ¸Ã—â‰1 (â‰ mt)âŠ¸â¥Šâ‰1 v Take mf }
Map â† {valğ•Šm: mâŠ¸Ã—â‰1 val}
NormM â† Â¬âŠ¸(+â‰1)
Pos â† âŠ‘/
Size â† +Â´

PS â† {ğ•Šamount:
	max_life â† 2
	spawn_point â‡ Ã·âŸœ2 wâ€¿h

	m â† {
		pâ€¿vâ€¿fâ€¿lâ€¿s â† options â† â†•5
		comp â† pâ€¿pâ€¿vâ€¿vâ€¿fâ€¿lâ€¿s
		[pos, vel, fric, life, size] â‡ options =âŒœ comp
	}

	Get â† {ğ•Š:
		pos â† spawn_point + â€¢rand.RangeÂ¨ + 20â€¿20
		vel â† (10-â€¢rand.RangeÂ¨ 20â€¿20) Ã· 10
		fric â† 1 - 0.0001 Ã— â€¢rand.Range 200
		life â† (â€¢rand.Range max_lifeÃ—100)Ã·100
		size â† 4 + 0.1 Ã— â€¢rand.Range 30

		posâˆ¾velâˆ¾fricâˆ¾lifeâˆ¾size
	}
	p â† >GetÂ¨ â†•amount

	Update â‡ {ğ•Š attractorsâ€¿sp:
		spawn_point â†© sp
		p {ğ•© - m.life Ã— 0.01}Ë˜â†©
		p {0 â‰¥âŠ‘ ğ•© Take m.life ? Get @ ; ğ•©}Ë˜ â†©

		{p {pğ•Šattr:
			to_attr â† NormË˜ attr -â‰1 p Take m.pos
			p + âŸ¨1â€¿1, m.velâŸ© FromToËœ Ã—âŸœ0.4 to_attr
		}â†© ğ•© }Ë˜ attractors

		p {m.vel NormM ğ•© FromTo m.fricâ€¿m.vel}âŠ¸Ã—â†©
		p {ğ•© FromTo m.velâ€¿m.pos}âŠ¸+â†©
	}

	Draw â‡ {ğ•Š:
		poss â† p Take m.pos
		sizes â† âˆ¾Ë˜Ëœ p Take m.size
		shapes â† poss (âŠ£â‰+)Ë˜ sizes

		life â† p Take m.life
		colors â† 255 âˆ¾ËœË˜ 255âŠ¸-Ë˜ âŒŠ|255 Ã— 3â¥ŠË˜ Ã·Ë˜âŸœmax_life life

		colors d.RectangleË˜ âŒŠshapes
	}
}

Attr â† {ağ•Šwâ€¿h:
	amount â† a
	attrs â‡ â€¢rand.RangeÂ¨ amountâ€¿2â¥Šwâ€¿h
	goal_poss â† attrs

	NewPos â‡ {ğ•Šwâ€¿h: goal_poss â†© â€¢rand.RangeÂ¨ amountâ€¿2â¥Šwâ€¿h}
	Draw â‡ {ğ•Š: {c.black d.Ellipse âŒŠ ğ•© (âŠ£â‰+) 20â€¿20}Ë˜ attrs }
	Update â‡ {ğ•Š: attrs +â†© 0.04 Ã— goal_poss-attrs }
}

particles â† PS 400
attractors â† 3 Attr wâ€¿h

_OnStart â† {System _ğ•£ ğ•©:
	win.SetSize wâ€¿h
	particlesâ†PS 400
	attractorsâ† 3 Attr wâ€¿h
	System particlesâ€¿attractors
}

PerFrame â† {ğ•Š world:

	attractors.UpdateâŸ¨âŸ©
	particles.Update attractors.attrsâ€¿(mouse.GetPosâŸ¨âŸ©)
	particles.DrawâŸ¨âŸ©
	attractors.DrawâŸ¨âŸ©

	{key.IsPressed key.space ? attractors.NewPos wâ€¿h ; @}
} d._withCanvas_ c.white

System â† PerFrame â€¢_While_(Â¬win.ShouldClose) _OnStart
System win._openAs "test"
