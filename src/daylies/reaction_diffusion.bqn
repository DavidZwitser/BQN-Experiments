âŸ¨winâ‡window, dâ‡drawâŸ©â†râ†â€¢Import "../../rayed-bqn/rayed.bqn"

win.SetSize sizeâ†800â€¿800
scale â† 10
grid â† âŒŠsizeÃ·scale
Sow â† {ğ•¨âŒ¾((â€¢rand.RangeÂ¨â‰¢ğ•©)âŠ‘âŠ¢)ğ•©}

a â† 0âŠ¸SowâŸ20 gridâ¥Š1
b â† Â¬a

d1 â† 1
d2 â† 0.5
f â† 0.035
k â† 0.058

diffusion_grid â† [
	0.05â€¿0.2â€¿0.05
	0.2â€¿ Â¯1 â€¿0.2
	0.05â€¿0.2â€¿0.05
]

PerFrame â† {ğ•Š:
	[a, b] â†© |1â€¿2â‰>Ë˜ {gağ•Šgb:
		a â† 1âŠ‘1âŠa â‹„ b â† 1âŠ‘1âŠb
		âŸ¨+âŸœ(fÃ—1-a) -âŸœ(aÃ—bÃ—b) +Â´+Ë d1 Ã— ga + diffusion_grid
		 +âŸœ(f+kÃ—b) +âŸœ(aÃ—bÃ—b) +Â´+Ë d2 Ã— gb + diffusion_gridâŸ©
	}Â¨Â´ { ğ•©âŠ¸{3â€¿3âŠ¸â†‘ (ğ•©+1)âŠ¸âŒ½ ğ•¨ }Â¨ â†•â‰¢ğ•©}Â¨ aâ€¿b

	â†•âˆ˜â‰¢âŠ¸({xâ€¿yğ•Šaâ€¿b: (|âŒŠ0âŠ¸âŒˆ255âŠ¸âŒŠâŸ¨aÃ—255, bÃ—255, 0, 255âŸ©) d.Rectangle |âŒŠ(xâ€¿yÃ—scale) (âŠ£â‰+) âˆ¾Ëœ scale}Â¨) aâˆ¾Â¨b
} d._withCanvas_ (4â¥Š255)

System â† PerFrameâ€¢_While_(Â¬r.window.ShouldClose)
System r.window._openAs "example"
